{% extends 'core3/base_rrhh.html' %}
{% load static %}

{% block title %}Solicitudes de Empleo - Recursos Humanos{% endblock %}

{% block content %}
<main class="main-content">
    <section class="seccion">
        <h2>Solicitudes de Empleo</h2>
        <p>Gestión de candidatos y procesos de contratación</p>
    </section>

    <!-- Filtros -->
    <section class="seccion">
        <div class="filtros">
            <a href="{% url 'lista_solicitudes_rrhh' %}?estado=todas" 
               class="button {% if filtro_actual == 'todas' %}green{% endif %}">
                Todas
            </a>
            <a href="{% url 'lista_solicitudes_rrhh' %}?estado=pendientes" 
               class="button {% if filtro_actual == 'pendientes' %}blue{% endif %}">
                Pendientes
            </a>
            <a href="{% url 'lista_solicitudes_rrhh' %}?estado=aprobadas" 
               class="button {% if filtro_actual == 'aprobadas' %}{% endif %}">
                Aprobadas
            </a>
            <a href="{% url 'lista_solicitudes_rrhh' %}?estado=rechazadas" 
               class="button {% if filtro_actual == 'rechazadas' %}red{% endif %}">
                Rechazadas
            </a>
        </div>
    </section>

    <!-- Lista de Solicitudes -->
    <section class="seccion">
        {% if solicitudes %}
        <div style="overflow-x: auto;">
            <table class="table table--striped table--hover">
                <tbody>
                    <tr>
                        <th>#</th>
                        <th>Nombre Completo</th>
                        <th>Cédula</th>
                        <th>Correo</th>
                        <th>Categoría</th>
                        <th>Mensaje</th>
                        <th>Estado</th>
                        <th>Fecha Solicitud</th>
                        <th>Acciones</th>
                    </tr>
                    {% for solicitud in solicitudes %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td><strong>{{ solicitud.persona.nombre }} {{ solicitud.persona.apellido }}</strong></td>
                        <td>{{ solicitud.persona.cedula }}</td>
                        <td>{{ solicitud.persona.correo }}</td>
                        <td>
                            {% if solicitud.categoria %}
                                <span class="badge badge-info">{{ solicitud.categoria.nombre }}</span>
                            {% else %}
                                <span class="badge badge-secondary">Sin categoría</span>
                            {% endif %}
                        </td>
                        <td>{{ solicitud.mensaje|truncatewords:10 }}</td>
                        <td>
                            {% if solicitud.estado.nombre == 'Pendiente' %}
                                <span class="badge badge-warning">⏳ Pendiente</span>
                            {% elif solicitud.estado.nombre == 'Aprobado' %}
                                <span class="badge badge-success">✓ Aprobado</span>
                            {% elif solicitud.estado.nombre == 'Rechazado' %}
                                <span class="badge badge-danger">✗ Rechazado</span>
                            {% else %}
                                <span class="badge badge-secondary">{{ solicitud.estado.nombre }}</span>
                            {% endif %}
                        </td>
                        <td>{{ solicitud.fecha_creacion|date:"d/m/Y H:i" }}</td>
                        <td>
                            {% if solicitud.estado.nombre == 'Pendiente' %}
                                <a href="{% url 'revisar_solicitud' solicitud.id %}" 
                                   class="button blue" style="padding: 8px 16px; font-size: 14px;">
                                    Revisar
                                </a>
                            {% elif solicitud.estado.nombre == 'Aprobado' %}
                                <a href="{% url 'contratar_empleado' solicitud.id %}" 
                                   class="button green" style="padding: 8px 16px; font-size: 14px;">
                                    Contratar
                                </a>
                            {% else %}
                                <span style="color: #888;">-</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Resumen -->
        <div class="cards-container" style="margin-top: 30px;">
            <div class="card stat-card">
                <div class="stat-number">{{ solicitudes|length }}</div>
                <div class="stat-label">Total en esta vista</div>
            </div>
        </div>
        {% else %}
        <div class="texto-centro">
            <p>No hay solicitudes con el filtro seleccionado.</p>
        </div>
        {% endif %}
    </section>

    <section class="seccion texto-centro">
        <a href="{% url 'dashboard_rrhh' %}" class="button">Volver al Dashboard</a>
    </section>
</main>
{% endblock %}