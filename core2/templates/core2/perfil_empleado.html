{% extends 'core2/base.html' %}
{% load static %}

{% block title %}Mi Perfil - Portal Empleados{% endblock %}

{% block content %}
<main class="main-content">
    {% if messages %}
    {% for message in messages %}
    <section class="seccion {% if message.tags == 'success' %}msg-success{% elif message.tags == 'error' %}msg-error{% else %}msg-info{% endif %}">
        {{ message }}
    </section>
    {% endfor %}
    {% endif %}

    <section class="seccion texto-centro">
        <h2>Mi Perfil</h2>
        <p>Consulta y actualiza tu informaci√≥n personal</p>
    </section>

    <!-- Informaci√≥n Actual -->
    <section class="seccion">
        <h3>Informaci√≥n Actual</h3>
        <div class="cards-container">
            <div class="card">
                <h4 class="card-title">üë§ Datos Personales</h4>
                <p class="card-content">
                    <strong>Nombre Completo:</strong> {{ empleado.nombre }} {{ empleado.apellido }}<br>
                    <strong>C√©dula:</strong> {{ empleado.cedula }}<br>
                    <strong>Fecha de Nacimiento:</strong> {{ empleado.fecha_nacimiento|date:"d/m/Y"|default:"No registrada" }}
                </p>
            </div>

            <div class="card">
                <h4 class="card-title">üìß Contacto</h4>
                <p class="card-content">
                    <strong>Correo:</strong> {{ empleado.correo }}<br>
                    <strong>Tel√©fono:</strong> {{ empleado.telefono|default:"No registrado" }}<br>
                    <strong>Direcci√≥n:</strong> {{ empleado.direccion|default:"No registrada" }}
                </p>
            </div>

            <div class="card">
                <h4 class="card-title">üíº Informaci√≥n Laboral</h4>
                <p class="card-content">
                    <strong>Categor√≠a:</strong> {{ empleado.categoria.nombre|default:"No asignada" }}<br>
                    <strong>Fecha de Ingreso:</strong> {{ empleado.fecha_ingreso|date:"d/m/Y" }}<br>
                    <strong>A√±os en la empresa:</strong> {{ empleado.anos_en_empresa }}<br>
                    <strong>D√≠as laborados:</strong> {{ empleado.dias_en_empresa }}
                </p>
            </div>

            {% if empleado.categoria %}
            <div class="card">
                <h4 class="card-title">üí∞ Informaci√≥n Salarial</h4>
                <p class="card-content">
                    <strong>Salario Base:</strong> ${{ empleado.categoria.salario_base|floatformat:2 }}<br>
                    <strong>Descripci√≥n:</strong> {{ empleado.categoria.descripcion|truncatewords:20 }}
                </p>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- Formulario de Actualizaci√≥n -->
    <section class="seccion">
        <h3>Actualizar Informaci√≥n</h3>
        <div class="form-section">
            <form method="POST" class="form azul">
                {% csrf_token %}
                
                {% if form.errors %}
                <div style="background: rgba(245, 87, 108, 0.2); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <strong>Por favor, corrija los siguientes errores:</strong>
                    {{ form.non_field_errors }}
                </div>
                {% endif %}

                <h4 style="text-align: center; margin-bottom: 30px;">Datos Personales</h4>
                
                <div>
                    <label for="{{ form.nombre.id_for_label }}">Nombre *</label>
                    {{ form.nombre }}
                    {% if form.nombre.errors %}
                        <span style="color: #f5576c;">{{ form.nombre.errors.0 }}</span>
                    {% endif %}
                </div>

                <div>
                    <label for="{{ form.apellido.id_for_label }}">Apellido *</label>
                    {{ form.apellido }}
                    {% if form.apellido.errors %}
                        <span style="color: #f5576c;">{{ form.apellido.errors.0 }}</span>
                    {% endif %}
                </div>

                <div>
                    <label for="{{ form.cedula.id_for_label }}">C√©dula *</label>
                    {{ form.cedula }}
                    {% if form.cedula.errors %}
                        <span style="color: #f5576c;">{{ form.cedula.errors.0 }}</span>
                    {% endif %}
                    <small style="display: block; margin-top: 5px; color: #888;">
                        Si necesita cambiar su c√©dula, contacte a recursos humanos
                    </small>
                </div>

                <div>
                    <label for="{{ form.correo.id_for_label }}">Correo Electr√≥nico *</label>
                    {{ form.correo }}
                    {% if form.correo.errors %}
                        <span style="color: #f5576c;">{{ form.correo.errors.0 }}</span>
                    {% endif %}
                </div>

                <div>
                    <label for="{{ form.telefono.id_for_label }}">Tel√©fono</label>
                    {{ form.telefono }}
                    {% if form.telefono.errors %}
                        <span style="color: #f5576c;">{{ form.telefono.errors.0 }}</span>
                    {% endif %}
                </div>

                <div>
                    <label for="{{ form.direccion.id_for_label }}">Direcci√≥n</label>
                    {{ form.direccion }}
                    {% if form.direccion.errors %}
                        <span style="color: #f5576c;">{{ form.direccion.errors.0 }}</span>
                    {% endif %}
                </div>

                <div>
                    <label for="{{ form.fecha_nacimiento.id_for_label }}">Fecha de Nacimiento</label>
                    {{ form.fecha_nacimiento }}
                    {% if form.fecha_nacimiento.errors %}
                        <span style="color: #f5576c;">{{ form.fecha_nacimiento.errors.0 }}</span>
                    {% endif %}
                </div>

                <div>
                    <label for="{{ form.categoria.id_for_label }}">Categor√≠a</label>
                    {{ form.categoria }}
                    {% if form.categoria.errors %}
                        <span style="color: #f5576c;">{{ form.categoria.errors.0 }}</span>
                    {% endif %}
                    <small style="display: block; margin-top: 5px; color: #888;">
                        Solo recursos humanos puede cambiar la categor√≠a
                    </small>
                </div>

                <div style="background: rgba(79, 172, 254, 0.1); padding: 15px; border-radius: 10px; margin-top: 20px;">
                    <strong>‚ÑπÔ∏è Nota:</strong>
                    <p style="margin-top: 10px;">
                        Algunos campos como la categor√≠a solo pueden ser modificados por el
                        departamento de recursos humanos. Si necesita cambiar informaci√≥n
                        que no puede editar, por favor contacte al administrador.
                    </p>
                </div>

                <button type="submit" class="buttonformB">Actualizar Informaci√≥n</button>
                <a href="{% url 'dashboard_empleado' %}" class="buttonformB" style="background: rgba(108, 117, 125, 0.2); border-color: #6c757d; text-decoration: none; display: block;">
                    Cancelar
                </a>
            </form>
        </div>
    </section>

    <!-- Estad√≠sticas -->
    <section class="seccion">
        <h3>Mis Estad√≠sticas</h3>
        <div class="cards-container">
            <div class="card">
                <h4 class="card-title">‚è±Ô∏è Antig√ºedad</h4>
                <p class="card-content" style="font-size: 2rem; font-weight: bold; color: #4facfe;">
                    {{ empleado.anos_en_empresa }}
                </p>
                <p class="card-content">a√±os en la empresa</p>
            </div>

            <div class="card">
                <h4 class="card-title">üìÖ D√≠as Laborados</h4>
                <p class="card-content" style="font-size: 2rem; font-weight: bold; color: #43e97b;">
                    {{ empleado.dias_en_empresa }}
                </p>
                <p class="card-content">d√≠as desde tu ingreso</p>
            </div>

            <div class="card">
                <h4 class="card-title">üìä Estado</h4>
                <p class="card-content">
                    {% if empleado.activo %}
                        <span style="font-size: 2rem; color: #43e97b;">‚úì Activo</span>
                    {% else %}
                        <span style="font-size: 2rem; color: #f5576c;">‚óã Inactivo</span>
                    {% endif %}
                </p>
            </div>
        </div>
    </section>
</main>
{% endblock %}