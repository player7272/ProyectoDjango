{% extends 'base.html' %}
{% load static %}

{% block title %} Estado de Solicitudes {% endblock %}

{% block content %}
<main class="main-content">
    <h2 class="texto-centro">Consulta el estado de tus solicitudes</h2>

    <!-- Formulario para buscar -->
    <form method="post" action="{% url 'estado' %}" class="form">
        {% csrf_token %}
        <div>
            <label for="email">Correo:</label>
            <input type="email" id="email" name="email" class="input" placeholder="correo@example.com" required>
        </div>
        <div>
            <label for="cedula">Número de Cédula:</label>
            <input type="text" id="cedula" name="cedula" class="input" placeholder="123456789" required>
        </div>
        <button type="submit" class="buttonformB">Ver Estado</button>
    </form>

    {% if error %}
        <p style="color:red;">{{ error }}</p>
    {% endif %}

    {% if persona %}
        <h3>Datos de la persona</h3>
        <table class="table">
            <tr>
                <th>Nombre</th>
                <th>Correo</th>
                <th>Cédula</th>
            </tr>
            <tr>
                <td>{{ persona.nombre }} {{ persona.apellido }}</td>
                <td>{{ persona.correo }}</td>
                <td>{{ persona.cedula }}</td>
            </tr>
        </table>

        <h3>Solicitudes registradas</h3>
        {% if solicitudes %}
            <table class="table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Mensaje</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
                    {% for solicitud in solicitudes %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ solicitud.mensaje }}</td>
                        <td>{{ solicitud.estado.nombre }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No hay solicitudes registradas para esta persona.</p>
        {% endif %}
    {% endif %}
</main>
{% endblock %}
